{"version":3,"file":"jobs.js","names":["_lodash","_interopRequireDefault","require","_lodash2","_commonTags","_moment","jobsReducer","state","active","done","action","type","_state$active","payload","id","Error","index","findIndex","j","mergedJob","merge","createdAt","Date","now","plugin","push","_state$active2","completedAt","oneLine","get","job","splice","runTime","moment","diff","exports"],"sources":["../../../src/redux/reducers/jobs.ts"],"sourcesContent":["import get from \"lodash.get\";\nimport merge from \"lodash.merge\";\nimport { oneLine } from \"common-tags\";\nimport moment from \"moment\";\n\nimport { IGatsbyState, ActionsUnion } from \"../types\";\n\nexport const jobsReducer = (\n  state: IGatsbyState[\"jobs\"] = { active: [], done: [] },\n  action: ActionsUnion,\n): IGatsbyState[\"jobs\"] => {\n  switch (action.type) {\n    case `CREATE_JOB`:\n    case `SET_JOB`: {\n      if (!action.payload.id) {\n        throw new Error(`An ID must be provided when creating or setting job`);\n      }\n      const index = state.active?.findIndex((j) => j.id === action.payload.id);\n      if (index !== -1) {\n        const mergedJob = merge(state.active[index], {\n          ...action.payload,\n          createdAt: Date.now(),\n          plugin: action.plugin,\n        });\n\n        state.active[index] = mergedJob;\n        return state;\n      } else {\n        state.active.push({\n          ...action.payload,\n          createdAt: Date.now(),\n          plugin: action.plugin,\n        });\n        return state;\n      }\n    }\n    case `END_JOB`: {\n      if (!action.payload.id) {\n        throw new Error(`An ID must be provided when ending a job`);\n      }\n      const completedAt = Date.now();\n      const index = state.active?.findIndex((j) => j.id === action.payload.id);\n      if (index === -1) {\n        throw new Error(oneLine`\n          The plugin \"${get(action, `plugin.name`, `anonymous`)}\"\n          tried to end a job with the id \"${action.payload.id}\"\n          that either hasn't yet been created or has already been ended`);\n      }\n      const job = state.active.splice(index, 1)[0];\n      state.done.push({\n        ...job,\n        completedAt,\n        runTime: moment(completedAt).diff(moment(job.createdAt)),\n      });\n\n      return state;\n    }\n  }\n\n  return state;\n};\n"],"mappings":";;;;;AAAA,IAAAA,OAAA,GAAAC,sBAAA,CAAAC,OAAA;AACA,IAAAC,QAAA,GAAAF,sBAAA,CAAAC,OAAA;AACA,IAAAE,WAAA,GAAAF,OAAA;AACA,IAAAG,OAAA,GAAAJ,sBAAA,CAAAC,OAAA;AAIO,MAAMI,WAAW,GAAGA,CACzBC,KAA2B,GAAG;EAAEC,MAAM,EAAE,EAAE;EAAEC,IAAI,EAAE;AAAG,CAAC,EACtDC,MAAoB,KACK;EACzB,QAAQA,MAAM,CAACC,IAAI;IACjB,KAAM,YAAW;IACjB,KAAM,SAAQ;MAAE;QAAA,IAAAC,aAAA;QACd,IAAI,CAACF,MAAM,CAACG,OAAO,CAACC,EAAE,EAAE;UACtB,MAAM,IAAIC,KAAK,CAAE,qDAAoD,CAAC;QACxE;QACA,MAAMC,KAAK,IAAAJ,aAAA,GAAGL,KAAK,CAACC,MAAM,cAAAI,aAAA,uBAAZA,aAAA,CAAcK,SAAS,CAAEC,CAAC,IAAKA,CAAC,CAACJ,EAAE,KAAKJ,MAAM,CAACG,OAAO,CAACC,EAAE,CAAC;QACxE,IAAIE,KAAK,KAAK,CAAC,CAAC,EAAE;UAChB,MAAMG,SAAS,GAAG,IAAAC,gBAAK,EAACb,KAAK,CAACC,MAAM,CAACQ,KAAK,CAAC,EAAE;YAC3C,GAAGN,MAAM,CAACG,OAAO;YACjBQ,SAAS,EAAEC,IAAI,CAACC,GAAG,CAAC,CAAC;YACrBC,MAAM,EAAEd,MAAM,CAACc;UACjB,CAAC,CAAC;UAEFjB,KAAK,CAACC,MAAM,CAACQ,KAAK,CAAC,GAAGG,SAAS;UAC/B,OAAOZ,KAAK;QACd,CAAC,MAAM;UACLA,KAAK,CAACC,MAAM,CAACiB,IAAI,CAAC;YAChB,GAAGf,MAAM,CAACG,OAAO;YACjBQ,SAAS,EAAEC,IAAI,CAACC,GAAG,CAAC,CAAC;YACrBC,MAAM,EAAEd,MAAM,CAACc;UACjB,CAAC,CAAC;UACF,OAAOjB,KAAK;QACd;MACF;IACA,KAAM,SAAQ;MAAE;QAAA,IAAAmB,cAAA;QACd,IAAI,CAAChB,MAAM,CAACG,OAAO,CAACC,EAAE,EAAE;UACtB,MAAM,IAAIC,KAAK,CAAE,0CAAyC,CAAC;QAC7D;QACA,MAAMY,WAAW,GAAGL,IAAI,CAACC,GAAG,CAAC,CAAC;QAC9B,MAAMP,KAAK,IAAAU,cAAA,GAAGnB,KAAK,CAACC,MAAM,cAAAkB,cAAA,uBAAZA,cAAA,CAAcT,SAAS,CAAEC,CAAC,IAAKA,CAAC,CAACJ,EAAE,KAAKJ,MAAM,CAACG,OAAO,CAACC,EAAE,CAAC;QACxE,IAAIE,KAAK,KAAK,CAAC,CAAC,EAAE;UAChB,MAAM,IAAID,KAAK,CAAC,IAAAa,mBAAO,CAAC;AAChC,wBAAwB,IAAAC,eAAG,EAACnB,MAAM,EAAG,aAAY,EAAG,WAAU,CAAE;AAChE,4CAA4CA,MAAM,CAACG,OAAO,CAACC,EAAG;AAC9D,wEAAwE,CAAC;QACnE;QACA,MAAMgB,GAAG,GAAGvB,KAAK,CAACC,MAAM,CAACuB,MAAM,CAACf,KAAK,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC;QAC5CT,KAAK,CAACE,IAAI,CAACgB,IAAI,CAAC;UACd,GAAGK,GAAG;UACNH,WAAW;UACXK,OAAO,EAAE,IAAAC,eAAM,EAACN,WAAW,CAAC,CAACO,IAAI,CAAC,IAAAD,eAAM,EAACH,GAAG,CAACT,SAAS,CAAC;QACzD,CAAC,CAAC;QAEF,OAAOd,KAAK;MACd;EACF;EAEA,OAAOA,KAAK;AACd,CAAC;AAAC4B,OAAA,CAAA7B,WAAA,GAAAA,WAAA"}