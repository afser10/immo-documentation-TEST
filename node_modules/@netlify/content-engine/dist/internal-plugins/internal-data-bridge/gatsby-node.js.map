{"version":3,"file":"gatsby-node.js","names":["_moment","_interopRequireDefault","require","_lodash","transformPackageJson","json","transformDeps","deps","Object","entries","map","name","version","pick","dependencies","devDependencies","peerDependencies","optionalDependecies","bundledDependecies","exports","sourceNodes","createContentDigest","actions","store","createNode","program","flattenedPlugins","config","getState","forEach","plugin","pluginFilepath","resolve","packageJson","parent","children","internal","contentDigest","type","createGatsbyConfigNode","configCopy","plugins","node","siteMetadata","port","host","id","buildTime","moment","subtract","process","uptime","startOf","toJSON","metadataNode","createResolvers","resolvers","Site","source","args","context","info","nodeModel","getNodeById","originalResolver"],"sources":["../../../src/internal-plugins/internal-data-bridge/gatsby-node.ts"],"sourcesContent":["import moment from \"moment\";\nimport pick from \"lodash.pick\";\n\nfunction transformPackageJson(json) {\n  const transformDeps = (deps) =>\n    deps &&\n    Object.entries(deps).map(([name, version]) => {\n      return {\n        name,\n        version,\n      };\n    });\n\n  json = pick(json, [\n    `name`,\n    `description`,\n    `version`,\n    `main`,\n    `keywords`,\n    `author`,\n    `license`,\n    `dependencies`,\n    `devDependencies`,\n    `peerDependencies`,\n    `optionalDependecies`,\n    `bundledDependecies`,\n  ]);\n  json.dependencies = transformDeps(json.dependencies);\n  json.devDependencies = transformDeps(json.devDependencies);\n  json.peerDependencies = transformDeps(json.peerDependencies);\n  json.optionalDependecies = transformDeps(json.optionalDependecies);\n  json.bundledDependecies = transformDeps(json.bundledDependecies);\n\n  return json;\n}\n\nexports.sourceNodes = ({ createContentDigest, actions, store }) => {\n  const { createNode } = actions;\n  const { program, flattenedPlugins, config } = store.getState();\n\n  flattenedPlugins.forEach((plugin) => {\n    plugin.pluginFilepath = plugin.resolve;\n\n    createNode({\n      ...plugin,\n      packageJson: transformPackageJson(\n        require(`${plugin.resolve}/package.json`),\n      ),\n      parent: null,\n      children: [],\n      internal: {\n        contentDigest: createContentDigest(plugin),\n        type: `SitePlugin`,\n      },\n    });\n  });\n\n  const createGatsbyConfigNode = (config = {}) => {\n    // Delete plugins from the config as we add plugins above.\n    const configCopy: any = { ...config };\n    delete configCopy.plugins;\n    const node = {\n      siteMetadata: {\n        ...configCopy.siteMetadata,\n      },\n      port: program.port,\n      host: program.host,\n      ...configCopy,\n    };\n    createNode({\n      ...node,\n      id: `Site`,\n      parent: null,\n      children: [],\n      internal: {\n        contentDigest: createContentDigest(node),\n        type: `Site`,\n      },\n    });\n  };\n\n  createGatsbyConfigNode(config);\n\n  const buildTime = moment()\n    .subtract(process.uptime(), `seconds`)\n    .startOf(`second`)\n    .toJSON();\n\n  const metadataNode = { buildTime };\n\n  createNode({\n    ...metadataNode,\n    id: `SiteBuildMetadata`,\n    parent: null,\n    children: [],\n    internal: {\n      contentDigest: createContentDigest(metadataNode),\n      type: `SiteBuildMetadata`,\n    },\n  });\n};\n\nexports.createResolvers = ({ createResolvers }) => {\n  const resolvers = {\n    Site: {\n      buildTime: {\n        type: `Date`,\n        resolve(source, args, context, info) {\n          const { buildTime } = context.nodeModel.getNodeById({\n            id: `SiteBuildMetadata`,\n            type: `SiteBuildMetadata`,\n          });\n          return info.originalResolver(\n            {\n              ...source,\n              buildTime,\n            },\n            args,\n            context,\n            info,\n          );\n        },\n      },\n    },\n  };\n\n  createResolvers(resolvers);\n};\n"],"mappings":"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"}